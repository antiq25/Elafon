  {% extends 'base.html' %}
  
  {% block content %}
  {% include 'loader.html' %}
  <div id="flashes">{% include 'flash.html' %}</div>
  <table class="display responsive nowrap" width="100%">
    <table id="items-table" class="table table-hover">
        <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Action</th>
      </tr>
    </thead>
    <!-- Table body content goes here -->
    </table>
  </div>
  <script>
    $(document).ready(function() {
      var itemsTable = $('#items-table').DataTable({
        language: {
          search: "Filter items:",
          lengthMenu: "Show _MENU_ items per page",
          info: "Showing _START_ to _END_ of _TOTAL_ items",
          infoEmpty: "No items available",
          infoFiltered: "(filtered from _MAX_ total items)",
          paginate: {
            first: "First",
            last: "Last",
            next: "Next",
            previous: "Previous"
          }
        },
        responsive: true,
        processing: true,
        lengthMenu: [5, 10, 20],
        columnDefs: [
          { responsivePriority: 1, targets: 0 },
          { responsivePriority: 2, targets: 1 }
        ]
      });


      function refreshTable() {
        $('#loader').show();
        $.getJSON('/get_equipment')
        .done(function(data) {
            if (Array.isArray(data)) {
                itemsTable.clear();
                data.forEach(function(item) {
                    var btnMarkup = `
                        <form method="POST" action="/equipment">
                            <input type="hidden" name="item_id" value="${item.id}">
                            <button type="submit" class="btn btn-primary">Sign out</button>
                        </form>
                    `;
                    itemsTable.row.add([
                        item.name,
                        item.type,
                        btnMarkup
                    ]);
                });
                itemsTable.draw();
            }
            $('#loader').hide();
        })
        .fail(function() {
            alert('Failed to fetch equipment. Please try again.');
            $('#loader').hide();
        });
      }
  
      $(document).ajaxComplete(function() {
          // Handle flash messages after every AJAX request
          setTimeout(function() {
              $('#flashes').fadeOut('slow', function() {
                  $('#flashes').empty().show();
              });
          }, 5000); 
      });
  
      refreshTable();
    });
  </script>
  {% endblock content %}
